<!DOCTYPE html>
<html>
<head>
    <title>Enhanced i2 Network Visualization</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 15px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        .header { 
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); 
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            text-align: center;
        }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px; 
            margin-bottom: 20px; 
        }
        .stat-card { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            text-align: center;
            border-left: 4px solid #3498db;
        }
        .stat-number { 
            font-size: 2em; 
            font-weight: bold; 
            color: #2c3e50; 
            margin-bottom: 5px;
        }
        .stat-label { 
            color: #7f8c8d; 
            font-size: 0.9em;
            text-transform: uppercase;
        }
        .controls-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        .control-group h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1em;
        }
        button { 
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); 
            color: white; 
            border: none; 
            padding: 8px 12px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 2px; 
            font-size: 0.9em;
            transition: all 0.3s;
            min-width: 80px;
        }
        button:hover { 
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        button.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        button.danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        select, input[type="range"] {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .slider-container {
            margin: 10px 0;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }
        #network { 
            width: 100%; 
            height: 600px; 
            background: white; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 2px solid #ecf0f1;
        }
        .info-panel { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-top: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .legend-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .legend-item { 
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 0.9em;
        }
        .legend-color { 
            width: 16px; 
            height: 16px; 
            border-radius: 50%;
            margin-right: 8px; 
            border: 1px solid #ddd;
        }
        .filter-active {
            border: 2px solid #f39c12 !important;
            background: #fef9e7 !important;
        }
        .status-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <span id="status">üü¢ Network Active</span>
    </div>

    <div class="container">
        <div class="header">
            <h1>üîç Enhanced i2 Network Visualization</h1>
            <p><strong>Advanced Cryptocurrency Investigation Tool</strong></p>
            <p>Generated: 2025-07-01 21:00:38 | Entities: 6 | Relationships: 5</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">6</div>
                <div class="stat-label">Total Entities</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">5</div>
                <div class="stat-label">Relationships</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div class="stat-label">Crypto Addresses</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div class="stat-label">High Risk</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">$5,025,000</div>
                <div class="stat-label">Total Value USD</div>
            </div>
        </div>
        
        <div class="controls-section">
            <h3 style="margin: 0 0 15px 0; color: #2c3e50;">üéõÔ∏è Advanced Network Controls</h3>
            <div class="controls-grid">
                
                <!-- View Controls -->
                <div class="control-group">
                    <h4>üì∑ View Controls</h4>
                    <button onclick="network.fit()" title="Fit all nodes in view">üîç Fit View</button>
                    <button onclick="zoomIn()" title="Zoom in">üîç+ Zoom In</button>
                    <button onclick="zoomOut()" title="Zoom out">üîç- Zoom Out</button>
                    <button onclick="resetView()" title="Reset to default view">üè† Reset</button>
                </div>
                
                <!-- Physics Controls -->
                <div class="control-group">
                    <h4>‚ö° Physics Engine</h4>
                    <button onclick="togglePhysics()" id="physicsBtn" title="Toggle physics simulation">‚ö° Toggle Physics</button>
                    <select id="physicsType" onchange="changePhysics()" title="Select physics algorithm">
                        <option value="barnesHut">Barnes-Hut</option>
                        <option value="repulsion">Repulsion</option>
                        <option value="hierarchicalRepulsion">Hierarchical</option>
                        <option value="forceAtlas2Based">Force Atlas</option>
                    </select>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Gravity</span>
                            <span id="gravityValue">-3000</span>
                        </div>
                        <input type="range" id="gravity" min="-10000" max="-500" value="-3000" 
                               onchange="updateGravity(this.value)">
                    </div>
                </div>
                
                <!-- Layout Controls -->
                <div class="control-group">
                    <h4>üìê Layout Algorithms</h4>
                    <button onclick="applyHierarchicalLayout()" title="Hierarchical layout">üå≤ Hierarchical</button>
                    <button onclick="applyCircularLayout()" title="Circular layout">‚≠ï Circular</button>
                    <button onclick="applyRandomLayout()" title="Random layout">üé≤ Random</button>
                    <button onclick="clusterByType()" title="Group by entity type">üéØ Cluster Types</button>
                </div>
                
                <!-- Filter Controls -->
                <div class="control-group">
                    <h4>üîç Filters</h4>
                    <button onclick="filterHighRisk()" id="riskFilter" title="Show only high risk entities">‚ö†Ô∏è High Risk Only</button>
                    <button onclick="filterByType('CryptoAddress')" title="Show only crypto addresses">‚Çø Addresses Only</button>
                    <button onclick="filterByType('Exchange')" title="Show only exchanges">üè¶ Exchanges Only</button>
                    <button onclick="clearFilters()" class="danger" title="Clear all filters">üîÑ Clear Filters</button>
                </div>
                
                <!-- Visual Controls -->
                <div class="control-group">
                    <h4>üé® Visual Options</h4>
                    <button onclick="toggleLabels()" id="labelsBtn" title="Show/hide labels">üè∑Ô∏è Toggle Labels</button>
                    <button onclick="toggleEdges()" id="edgesBtn" title="Show/hide edges">üîó Toggle Edges</button>
                    <button onclick="highlightConnections()" title="Highlight connections">‚ú® Highlight</button>
                    <select id="nodeSize" onchange="changeNodeSize()" title="Node size basis">
                        <option value="default">Default Size</option>
                        <option value="risk">Size by Risk</option>
                        <option value="value">Size by Value</option>
                        <option value="connections">Size by Connections</option>
                    </select>
                </div>
                
                <!-- Analysis Tools -->
                <div class="control-group">
                    <h4>üìä Analysis Tools</h4>
                    <button onclick="showNetworkStats()" title="Display network statistics">üìà Network Stats</button>
                    <button onclick="findShortestPath()" title="Find shortest path between nodes">üõ§Ô∏è Shortest Path</button>
                    <button onclick="detectCommunities()" title="Detect communities">üë• Communities</button>
                    <button onclick="exportAdvanced()" title="Export with advanced options">üíæ Export</button>
                </div>
                
            </div>
        </div>
        
        <div id="network"></div>
        
        <div class="info-panel">
            <h3>üè∑Ô∏è Interactive Legend & Information</h3>
            <div class="legend">
                <div class="legend-section">
                    <h4>Entity Types</h4>
                    <div class="legend-item"><div class="legend-color" style="background-color: #FF6B6B;"></div>Crypto Address</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #4ECDC4;"></div>Exchange</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #45B7D1;"></div>Wallet</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #96CEB4;"></div>Service</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #FFEAA7;"></div>Mixer</div>
                </div>
                <div class="legend-section">
                    <h4>Risk Levels</h4>
                    <div class="legend-item"><div class="legend-color" style="background-color: #e74c3c;"></div>High Risk</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #f39c12;"></div>Medium Risk</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #27ae60;"></div>Low Risk</div>
                </div>
                <div class="legend-section">
                    <h4>Relationship Types</h4>
                    <div class="legend-item"><div class="legend-color" style="background-color: #E74C3C;"></div>Suspicious Activity</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #3498DB;"></div>Regular Transaction</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #2ECC71;"></div>Service Usage</div>
                </div>
                <div class="legend-section">
                    <h4>Controls Help</h4>
                    <p><strong>Mouse:</strong> Drag to move, Scroll to zoom, Click for details</p>
                    <p><strong>Keyboard:</strong> Space to center, R to reset</p>
                    <p><strong>Multi-select:</strong> Ctrl+Click to select multiple nodes</p>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Initialize network data
        var originalNodes = new vis.DataSet([
  {
    "id": "btc_001",
    "label": "Genesis Block",
    "type": "CryptoAddress",
    "crypto": "BTC",
    "risk_level": "LOW",
    "balance": 0,
    "balance_usd": 0,
    "transaction_count": 1,
    "attributes": {
      "Address": "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa",
      "CryptoType": "BTC",
      "RiskLevel": "LOW",
      "Balance": "0 BTC",
      "FirstSeen": "2009-01-03",
      "Category": "Historical"
    }
  },
  {
    "id": "eth_001",
    "label": "High Value Wallet",
    "type": "CryptoAddress",
    "crypto": "ETH",
    "risk_level": "HIGH",
    "balance": 15.5,
    "balance_usd": 25000,
    "transaction_count": 156,
    "attributes": {
      "Address": "0x742d35Cc6639C0532fEb5001fE9C9c75A8fd8Ecd",
      "CryptoType": "ETH",
      "RiskLevel": "HIGH",
      "Balance": "15.5 ETH",
      "BalanceUSD": "$25,000",
      "DarknetExposure": "YES",
      "Category": "Suspicious"
    }
  },
  {
    "id": "exchange_001",
    "label": "Coinbase Exchange",
    "type": "Exchange",
    "crypto": "MULTI",
    "risk_level": "LOW",
    "balance": 0,
    "balance_usd": 0,
    "transaction_count": 50000,
    "attributes": {
      "Name": "Coinbase",
      "Type": "Exchange",
      "Category": "Centralized Exchange",
      "Country": "USA",
      "License": "Regulated",
      "RiskLevel": "LOW"
    }
  },
  {
    "id": "mixer_001",
    "label": "Privacy Mixer",
    "type": "Mixer",
    "crypto": "BTC",
    "risk_level": "HIGH",
    "balance": 0,
    "balance_usd": 0,
    "transaction_count": 2500,
    "attributes": {
      "Name": "CoinJoin Service",
      "Type": "Mixer",
      "Category": "Privacy Service",
      "RiskLevel": "HIGH",
      "Purpose": "Obfuscation"
    }
  },
  {
    "id": "wallet_001",
    "label": "Cold Storage",
    "type": "Wallet",
    "crypto": "BTC",
    "risk_level": "LOW",
    "balance": 100.5,
    "balance_usd": 5000000,
    "transaction_count": 5,
    "attributes": {
      "Address": "bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4",
      "Type": "Cold Storage",
      "Category": "Institutional",
      "RiskLevel": "LOW",
      "Balance": "100.5 BTC"
    }
  },
  {
    "id": "defi_001",
    "label": "DeFi Protocol",
    "type": "Service",
    "crypto": "ETH",
    "risk_level": "MEDIUM",
    "balance": 0,
    "balance_usd": 0,
    "transaction_count": 15000,
    "attributes": {
      "Name": "Uniswap V3",
      "Type": "DeFi Protocol",
      "Category": "Decentralized Exchange",
      "RiskLevel": "MEDIUM",
      "TVL": "$2.1B"
    }
  }
]);
        var originalEdges = new vis.DataSet([
  {
    "id": "link_001",
    "from": "btc_001",
    "to": "exchange_001",
    "type": "UsesService",
    "label": "Historical Transfer",
    "strength": 0.3,
    "attributes": {
      "Type": "UsesService",
      "Amount": "50 BTC",
      "Date": "2010-05-22",
      "Purpose": "First Commercial Transaction"
    }
  },
  {
    "id": "link_002",
    "from": "eth_001",
    "to": "mixer_001",
    "type": "SuspiciousActivity",
    "label": "Privacy Transaction",
    "strength": 0.8,
    "attributes": {
      "Type": "SuspiciousActivity",
      "Amount": "5.2 ETH",
      "RiskScore": "0.85",
      "Flags": "Money Laundering Risk"
    }
  },
  {
    "id": "link_003",
    "from": "wallet_001",
    "to": "exchange_001",
    "type": "SendsTo",
    "label": "Large Transfer",
    "strength": 0.6,
    "attributes": {
      "Type": "SendsTo",
      "Amount": "10.5 BTC",
      "Purpose": "Liquidation",
      "Frequency": "Quarterly"
    }
  },
  {
    "id": "link_004",
    "from": "eth_001",
    "to": "defi_001",
    "type": "ConnectedTo",
    "label": "DeFi Interaction",
    "strength": 0.4,
    "attributes": {
      "Type": "ConnectedTo",
      "Activity": "Liquidity Provision",
      "Frequency": "Weekly",
      "Value": "High"
    }
  },
  {
    "id": "link_005",
    "from": "mixer_001",
    "to": "exchange_001",
    "type": "SuspiciousActivity",
    "label": "Exit Transaction",
    "strength": 0.9,
    "attributes": {
      "Type": "SuspiciousActivity",
      "Amount": "Variable",
      "Pattern": "Structured Deposits",
      "Alert": "AML Review Required"
    }
  }
]);
        var nodes = new vis.DataSet(originalNodes.get());
        var edges = new vis.DataSet(originalEdges.get());
        var data = { nodes: nodes, edges: edges };
        
        // Advanced network options
        var options = {
            nodes: {
                shape: 'dot',
                size: 20,
                font: { 
                    size: 12, 
                    color: '#2c3e50',
                    strokeWidth: 2,
                    strokeColor: '#ffffff'
                },
                borderWidth: 2,
                shadow: {
                    enabled: true,
                    color: 'rgba(0,0,0,0.2)',
                    size: 8,
                    x: 2,
                    y: 2
                },
                chosen: {
                    node: function(values, id, selected, hovering) {
                        values.shadow = true;
                        values.shadowSize = 15;
                        values.shadowColor = 'rgba(0,0,0,0.4)';
                    }
                }
            },
            edges: {
                width: 2,
                shadow: {
                    enabled: true,
                    color: 'rgba(0,0,0,0.1)',
                    size: 3
                },
                smooth: { 
                    type: 'continuous',
                    forceDirection: 'none',
                    roundness: 0.5
                },
                arrows: { 
                    to: { 
                        enabled: true, 
                        scaleFactor: 0.6,
                        type: 'arrow'
                    } 
                },
                chosen: {
                    edge: function(values, id, selected, hovering) {
                        values.width = values.width * 1.5;
                        values.shadow = true;
                    }
                }
            },
            physics: {
                enabled: true,
                stabilization: { iterations: 200 },
                barnesHut: { 
                    gravitationalConstant: -3000, 
                    springConstant: 0.004, 
                    springLength: 150,
                    damping: 0.1
                },
                maxVelocity: 30,
                minVelocity: 0.1
            },
            interaction: {
                hover: true,
                tooltipDelay: 200,
                hideEdgesOnDrag: true,
                multiselect: true,
                selectConnectedEdges: false
            },
            layout: {
                improvedLayout: true,
                clusterThreshold: 150
            }
        };
        
        // Create network instance
        var container = document.getElementById('network');
        var network = new vis.Network(container, data, options);
        
        // Global state variables
        var physicsEnabled = true;
        var labelsVisible = true;
        var edgesVisible = true;
        var currentFilter = null;
        var selectedNodes = [];
        
        // Color mapping functions
        function getNodeColor(node) {
            const typeColors = {
                'CryptoAddress': '#FF6B6B',
                'Exchange': '#4ECDC4',
                'Wallet': '#45B7D1',
                'Service': '#96CEB4',
                'Mixer': '#FFEAA7'
            };
            
            const riskColors = {
                'HIGH': '#e74c3c',
                'MEDIUM': '#f39c12',
                'LOW': '#27ae60'
            };
            
            // Color by risk if available, otherwise by type
            return riskColors[node.risk_level] || typeColors[node.type] || '#95A5A6';
        }
        
        function getEdgeColor(edge) {
            const typeColors = {
                'SuspiciousActivity': '#E74C3C',
                'SendsTo': '#3498DB',
                'UsesService': '#2ECC71',
                'ConnectedTo': '#9B59B6'
            };
            return typeColors[edge.type] || '#7F8C8D';
        }
        
        // Apply colors to nodes and edges
        function applyColors() {
            var nodeUpdate = nodes.map(function(node) {
                return {
                    ...node,
                    color: {
                        background: getNodeColor(node),
                        border: node.risk_level === 'HIGH' ? '#c0392b' : '#2c3e50'
                    }
                };
            });
            nodes.update(nodeUpdate);
            
            var edgeUpdate = edges.map(function(edge) {
                return {
                    ...edge,
                    color: getEdgeColor(edge)
                };
            });
            edges.update(edgeUpdate);
        }
        
        // Event Handlers
        network.on("click", function (params) {
            if (params.nodes.length > 0) {
                var nodeId = params.nodes[0];
                var node = nodes.get(nodeId);
                showNodeDetails(node);
            } else if (params.edges.length > 0) {
                var edgeId = params.edges[0];
                var edge = edges.get(edgeId);
                showEdgeDetails(edge);
            }
        });
        
        network.on("selectNode", function(params) {
            selectedNodes = params.nodes;
            updateStatus(selectedNodes.length + " node(s) selected");
        });
        
        network.on("deselectNode", function(params) {
            selectedNodes = network.getSelectedNodes();
            updateStatus(selectedNodes.length + " node(s) selected");
        });
        
        network.on("hoverNode", function(params) {
            container.style.cursor = 'pointer';
            var node = nodes.get(params.node);
            updateStatus("Hovering: " + node.label);
        });
        
        network.on("blurNode", function(params) {
            container.style.cursor = 'default';
            updateStatus("üü¢ Network Active");
        });
        
        // View Control Functions
        function zoomIn() {
            var scale = network.getScale();
            network.moveTo({ scale: scale * 1.3 });
        }
        
        function zoomOut() {
            var scale = network.getScale();
            network.moveTo({ scale: scale * 0.7 });
        }
        
        function resetView() {
            network.fit({
                animation: {
                    duration: 1000,
                    easingFunction: 'easeInOutQuad'
                }
            });
        }
        
        // Physics Control Functions
        function togglePhysics() {
            physicsEnabled = !physicsEnabled;
            options.physics.enabled = physicsEnabled;
            network.setOptions(options);
            
            var btn = document.getElementById('physicsBtn');
            btn.className = physicsEnabled ? '' : 'active';
            btn.innerHTML = physicsEnabled ? '‚è∏Ô∏è Stop Physics' : '‚ñ∂Ô∏è Start Physics';
            updateStatus('Physics ' + (physicsEnabled ? 'enabled' : 'disabled'));
        }
        
        function changePhysics() {
            var type = document.getElementById('physicsType').value;
            
            switch(type) {
                case 'barnesHut':
                    options.physics.solver = 'barnesHut';
                    options.physics.barnesHut = {
                        gravitationalConstant: -3000,
                        springConstant: 0.004,
                        springLength: 150
                    };
                    break;
                case 'repulsion':
                    options.physics.solver = 'repulsion';
                    options.physics.repulsion = {
                        nodeDistance: 200,
                        springLength: 200
                    };
                    break;
                case 'hierarchicalRepulsion':
                    options.physics.solver = 'hierarchicalRepulsion';
                    break;
                case 'forceAtlas2Based':
                    options.physics.solver = 'forceAtlas2Based';
                    break;
            }
            
            network.setOptions(options);
            updateStatus('Physics changed to: ' + type);
        }
        
        function updateGravity(value) {
            document.getElementById('gravityValue').textContent = value;
            options.physics.barnesHut.gravitationalConstant = parseInt(value);
            network.setOptions(options);
        }
        
        // Layout Functions
        function applyHierarchicalLayout() {
            options.layout = {
                hierarchical: {
                    enabled: true,
                    direction: 'UD',
                    sortMethod: 'directed',
                    nodeSpacing: 200,
                    levelSeparation: 150
                }
            };
            network.setOptions(options);
            updateStatus('Applied hierarchical layout');
        }
        
        function applyCircularLayout() {
            var positions = {};
            var nodeIds = nodes.getIds();
            var angleStep = (2 * Math.PI) / nodeIds.length;
            var radius = 300;
            
            nodeIds.forEach(function(id, index) {
                var angle = index * angleStep;
                positions[id] = {
                    x: radius * Math.cos(angle),
                    y: radius * Math.sin(angle)
                };
            });
            
            network.setPositions(positions);
            updateStatus('Applied circular layout');
        }
        
        function applyRandomLayout() {
            var positions = {};
            var nodeIds = nodes.getIds();
            
            nodeIds.forEach(function(id) {
                positions[id] = {
                    x: (Math.random() - 0.5) * 1000,
                    y: (Math.random() - 0.5) * 1000
                };
            });
            
            network.setPositions(positions);
            updateStatus('Applied random layout');
        }
        
        function clusterByType() {
            // Clear existing clusters
            network.setData(data);
            
            var nodeTypes = [...new Set(originalNodes.get().map(n => n.type))];
            
            nodeTypes.forEach(function(type) {
                network.cluster({
                    joinCondition: function(nodeOptions) {
                        return nodeOptions.type === type;
                    },
                    clusterNodeProperties: {
                        id: 'cluster-' + type,
                        label: type + ' Cluster',
                        color: getNodeColor({type: type}),
                        size: 40,
                        borderWidth: 3
                    }
                });
            });
            
            updateStatus('Clustered by entity type');
        }
        
        // Filter Functions
        function filterHighRisk() {
            var btn = document.getElementById('riskFilter');
            
            if (currentFilter === 'risk') {
                clearFilters();
                return;
            }
            
            var filteredNodes = originalNodes.get().filter(n => n.risk_level === 'HIGH');
            var filteredNodeIds = filteredNodes.map(n => n.id);
            var filteredEdges = originalEdges.get().filter(e => 
                filteredNodeIds.includes(e.from) && filteredNodeIds.includes(e.to)
            );
            
            nodes.clear();
            edges.clear();
            nodes.add(filteredNodes);
            edges.add(filteredEdges);
            
            currentFilter = 'risk';
            btn.className = 'active';
            updateStatus('Showing only high risk entities');
        }
        
        function filterByType(type) {
            var filteredNodes = originalNodes.get().filter(n => n.type === type);
            var filteredNodeIds = filteredNodes.map(n => n.id);
            var filteredEdges = originalEdges.get().filter(e => 
                filteredNodeIds.includes(e.from) && filteredNodeIds.includes(e.to)
            );
            
            nodes.clear();
            edges.clear();
            nodes.add(filteredNodes);
            edges.add(filteredEdges);
            
            currentFilter = type;
            updateStatus('Showing only: ' + type);
        }
        
        function clearFilters() {
            nodes.clear();
            edges.clear();
            nodes.add(originalNodes.get());
            edges.add(originalEdges.get());
            
            currentFilter = null;
            document.getElementById('riskFilter').className = '';
            applyColors();
            updateStatus('Filters cleared');
        }
        
        // Visual Control Functions
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            var btn = document.getElementById('labelsBtn');
            
            options.nodes.font.size = labelsVisible ? 12 : 0;
            network.setOptions(options);
            
            btn.className = labelsVisible ? '' : 'active';
            btn.innerHTML = labelsVisible ? 'üè∑Ô∏è Hide Labels' : 'üè∑Ô∏è Show Labels';
            updateStatus('Labels ' + (labelsVisible ? 'shown' : 'hidden'));
        }
        
        function toggleEdges() {
            edgesVisible = !edgesVisible;
            var btn = document.getElementById('edgesBtn');
            
            if (edgesVisible) {
                edges.clear();
                edges.add(originalEdges.get());
            } else {
                edges.clear();
            }
            
            btn.className = edgesVisible ? '' : 'active';
            btn.innerHTML = edgesVisible ? 'üîó Hide Edges' : 'üîó Show Edges';
            updateStatus('Edges ' + (edgesVisible ? 'shown' : 'hidden'));
        }
        
        function highlightConnections() {
            if (selectedNodes.length === 0) {
                alert('Please select a node first');
                return;
            }
            
            var connectedNodes = new Set();
            var connectedEdges = new Set();
            
            selectedNodes.forEach(function(nodeId) {
                var connectedNodeIds = network.getConnectedNodes(nodeId);
                var connectedEdgeIds = network.getConnectedEdges(nodeId);
                
                connectedNodeIds.forEach(id => connectedNodes.add(id));
                connectedEdgeIds.forEach(id => connectedEdges.add(id));
            });
            
            // Highlight connected nodes
            var nodeUpdate = nodes.map(function(node) {
                var isConnected = connectedNodes.has(node.id) || selectedNodes.includes(node.id);
                return {
                    ...node,
                    color: {
                        background: isConnected ? getNodeColor(node) : '#bdc3c7',
                        border: isConnected ? '#2c3e50' : '#95a5a6'
                    },
                    size: isConnected ? 25 : 15
                };
            });
            nodes.update(nodeUpdate);
            
            updateStatus('Highlighted connections for ' + selectedNodes.length + ' node(s)');
        }
        
        function changeNodeSize() {
            var sizeType = document.getElementById('nodeSize').value;
            var nodeUpdate = [];
            
            originalNodes.get().forEach(function(node) {
                var size = 20; // default
                
                switch(sizeType) {
                    case 'risk':
                        size = node.risk_level === 'HIGH' ? 30 : 
                               node.risk_level === 'MEDIUM' ? 25 : 20;
                        break;
                    case 'value':
                        size = Math.min(40, 15 + (node.balance_usd / 100000));
                        break;
                    case 'connections':
                        var connections = network.getConnectedNodes(node.id).length;
                        size = 15 + (connections * 3);
                        break;
                }
                
                nodeUpdate.push({ ...node, size: size });
            });
            
            nodes.update(nodeUpdate);
            updateStatus('Node size changed to: ' + sizeType);
        }
        
        // Analysis Functions
        function showNetworkStats() {
            var nodesByType = {};
            var edgesByType = {};
            var riskDistribution = {};
            
            originalNodes.get().forEach(function(node) {
                nodesByType[node.type] = (nodesByType[node.type] || 0) + 1;
                riskDistribution[node.risk_level] = (riskDistribution[node.risk_level] || 0) + 1;
            });
            
            originalEdges.get().forEach(function(edge) {
                edgesByType[edge.type] = (edgesByType[edge.type] || 0) + 1;
            });
            
            var stats = "üìä Network Analysis Statistics\n\n";
            stats += "üîπ Total Entities: " + originalNodes.length + "\n";
            stats += "üîπ Total Relationships: " + originalEdges.length + "\n";
            stats += "üîπ Network Density: " + (originalEdges.length / (originalNodes.length * (originalNodes.length - 1)) * 100).toFixed(2) + "%\n\n";
            
            stats += "üìã Entity Types:\n";
            for (var type in nodesByType) {
                stats += "  ‚Ä¢ " + type + ": " + nodesByType[type] + "\n";
            }
            
            stats += "\n‚ö†Ô∏è Risk Distribution:\n";
            for (var risk in riskDistribution) {
                stats += "  ‚Ä¢ " + risk + ": " + riskDistribution[risk] + "\n";
            }
            
            stats += "\nüîó Relationship Types:\n";
            for (var type in edgesByType) {
                stats += "  ‚Ä¢ " + type + ": " + edgesByType[type] + "\n";
            }
            
            alert(stats);
        }
        
        function findShortestPath() {
            if (selectedNodes.length !== 2) {
                alert('Please select exactly 2 nodes to find shortest path');
                return;
            }
            
            var path = network.findNode(selectedNodes[0]);
            // This is a simplified version - real shortest path would need graph algorithms
            alert('Shortest path analysis between selected nodes:\n\nThis feature would implement Dijkstra\'s algorithm or similar graph traversal methods to find optimal paths through the network.');
        }
        
        function detectCommunities() {
            // Simplified community detection
            var communities = {};
            var communityId = 0;
            
            originalNodes.get().forEach(function(node) {
                if (!communities[node.type]) {
                    communities[node.type] = communityId++;
                }
            });
            
            var result = "üë• Community Detection Results:\n\n";
            for (var type in communities) {
                result += "Community " + communities[type] + ": " + type + " entities\n";
            }
            
            alert(result);
        }
        
        function exportAdvanced() {
            var exportData = {
                metadata: {
                    exported: new Date().toISOString(),
                    total_nodes: originalNodes.length,
                    total_edges: originalEdges.length,
                    current_filter: currentFilter,
                    physics_enabled: physicsEnabled
                },
                nodes: originalNodes.get(),
                edges: originalEdges.get(),
                positions: network.getPositions(),
                view_state: {
                    scale: network.getScale(),
                    position: network.getViewPosition()
                }
            };
            
            var dataStr = JSON.stringify(exportData, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            var url = URL.createObjectURL(dataBlob);
            var link = document.createElement('a');
            link.href = url;
            link.download = 'enhanced_network_export_' + new Date().toISOString().slice(0,19).replace(/:/g, '-') + '.json';
            link.click();
            URL.revokeObjectURL(url);
            
            updateStatus('‚úÖ Advanced export completed');
        }
        
        // Utility Functions
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function showNodeDetails(node) {
            var details = "üîç Entity Details\n\n";
            details += "üìã ID: " + node.id + "\n";
            details += "üè∑Ô∏è Type: " + node.type + "\n";
            details += "üìù Label: " + node.label + "\n";
            details += "‚ö†Ô∏è Risk Level: " + node.risk_level + "\n";
            details += "üí∞ Balance: $" + node.balance_usd.toLocaleString() + " USD\n";
            details += "üîÑ Transactions: " + node.transaction_count + "\n\n";
            
            details += "üìä Additional Attributes:\n";
            for (var key in node.attributes) {
                details += "‚Ä¢ " + key + ": " + node.attributes[key] + "\n";
            }
            
            alert(details);
        }
        
        function showEdgeDetails(edge) {
            var details = "üîó Relationship Details\n\n";
            details += "üìã ID: " + edge.id + "\n";
            details += "üè∑Ô∏è Type: " + edge.type + "\n";
            details += "üìù Label: " + edge.label + "\n";
            details += "üìä Strength: " + edge.strength + "\n";
            details += "üîÑ From: " + edge.from + "\n";
            details += "üîÑ To: " + edge.to + "\n\n";
            
            details += "üìä Additional Attributes:\n";
            for (var key in edge.attributes) {
                details += "‚Ä¢ " + key + ": " + edge.attributes[key] + "\n";
            }
            
            alert(details);
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            switch(event.code) {
                case 'Space':
                    event.preventDefault();
                    network.fit();
                    break;
                case 'KeyR':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        resetView();
                    }
                    break;
                case 'KeyP':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        togglePhysics();
                    }
                    break;
            }
        });
        
        // Initialize
        network.once("stabilizationIterationsDone", function() {
            applyColors();
            network.fit({
                animation: {
                    duration: 1000,
                    easingFunction: 'easeInOutQuad'
                }
            });
            updateStatus('üü¢ Network Ready - ' + originalNodes.length + ' entities loaded');
        });
        
        // Apply initial colors
        applyColors();
        
        console.log('üåê Enhanced i2 Network Visualization Loaded');
        console.log('üìä Features: Advanced Physics, Multiple Layouts, Filtering, Analysis Tools');
        console.log('‚å®Ô∏è Shortcuts: Space=Fit, Ctrl+R=Reset, Ctrl+P=Toggle Physics');
    </script>
</body>
</html>